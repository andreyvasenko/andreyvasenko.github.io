<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css">
    <meta name="author" content="Andrey Vasenko"/>
    <title>Andrey Vasenko</title>
 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    
    <script src="JS/myScript.js" type="text/javascript"></script>
    <script src="JS/tinycolor.js" type="text/javascript"></script>
    <script src="JS/three.js" type="text/javascript"></script>
    <script src="JS/OrbitControls.js" type="text/javascript"></script>

    <script src="JS/shaders/CopyShader.js"></script>
    <script src="JS/shaders/DigitalGlitch.js"></script>
    <script src="JS/shaders/FilmShader.js"></script>
    <script src="JS/shaders/RGBShiftShader.js"></script>

    <script src="JS/postprocessing/EffectComposer.js"></script>
    <script src="JS/postprocessing/RenderPass.js"></script>
    <script src="JS/postprocessing/ShaderPass.js"></script>
    <script src="JS/postprocessing/GlitchPass.js"></script>
    <script src="JS/postprocessing/FilmPass.js"></script>

  </head>
  
  <body onload='randomize();'>
    <div id="bggrad" style="position:absolute; height: 100%; width:100%; z-index:1;"></div>
    <div class="global-wrapper" style="z-index:2;">
  
      <div id="popup" style="position: absolute; bottom:10vh; height:0%; width:80%; z-index: 10; display:none; overflow: hidden;">   
        <video id="vid" controls>
          <source src="mov_bbb.mp4" type="video/mp4">
          <source src="mov_bbb.ogg" type="video/ogg">
          Your browser does not support HTML5 video.
          <!-- stop audio -->
        </video>
      </div>
      <div class="wrapper">
        <div class="panel a">
            <div class="an1">
                <object class ="an2" id="anim-object" data="animations/anim1.html"></object>  
            </div>
        </div>
        <div class="panel b"><h1 id = "changing_h">Hi! My name is Andrey Vasenko.</h1></div>
        <div class="panel c"> <div id = "mesh"></div></div>
        <div class="panel d" style="">
          <div class="linkwrap">
              <h3>Some stuff I made:</h3>
            <a href="https://thimbleprojects.org/andrey-v/340386/">
              <p class="link">a Thimble Project</p>
            </a>
            <a href="https://v-a-a.artstation.com/">
              <p class="link">my ArtStation</p>
            </a>
            <a href="https://codepen.io/v-a-a/">
              <p class="link">my CodePen</p>
            </a>
          </div>
        </div>
        <div class="panel e"><p>...</p></div>
      </div>  
    </div> 
    
    <script>    
      function renderContent() {
        // Setup a new scene
        var container = document.getElementById('mesh');
        var scene = new THREE.Scene();
        var clock = new THREE.Clock();

        // Setup the camera
        var camera = new THREE.PerspectiveCamera(40, container.clientWidth/container.clientHeight, 0.1, 1000);
        camera.position.z = 1;
        camera.position.y = 0.4;

        // Setup the renderer
        //var renderer = new THREE.WebGLRenderer();
        var renderer = new THREE.WebGLRenderer( { alpha: true } )

        renderer.setSize(container.clientWidth,container.clientHeight);
        container.appendChild(renderer.domElement);

        var composer;

        // Models
        var model;

        // Load the JSON files and provide callback functions (modelToScene
        var loader = new THREE.JSONLoader();
        loader.load( "mesh/untitled.json", addModelToScene);


        // After loading JSON from our file, we add it to the scene
        function addModelToScene( geometry, material ) {
          //var material = new THREE.MeshFaceMaterial(materials);
          model = new THREE.Mesh( geometry, material );
          model.scale.set(1,1,1);
          model.position.y += 0.1;
          scene.add( model );
        }

        // Add the lights
        var ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        var light1 = new THREE.PointLight( 0x0a80ff,1 );
        light1.position.set( 10, 1, -5 );
        scene.add( light1 );


        var light2 = new THREE.PointLight( 0xd856ea,0.5 );
        light2.position.set( 1, 1, 5 );
        scene.add( light2 );


        // Render loop to rotate our sphere by a little bit each frame
        var render = function () {
          requestAnimationFrame(render);

          if( typeof model != "undefined" ){
            model.rotation.y += 0.005;
            //model.rotation.x += 0.002;
          }

          //renderer.render(scene, camera);
          //composer.render(scene, camera);
          var delta = clock.getDelta();
          composer.render(delta);

        };

        //ORBIT CONTROLS
        controls = new THREE.OrbitControls(camera, container);
        controls.target.set( 0, 0, 0 );
        controls.enablePan = false;
        controls.enableKeys = false;
        controls.minDistance = 0.4;
        controls.maxDistance = 2;

        // postprocessing
        composer = new THREE.EffectComposer( renderer );
        composer.addPass( new THREE.RenderPass( scene, camera ) );

        var effect = new THREE.ShaderPass( THREE.RGBShiftShader );
        effect.uniforms[ 'amount' ].value = 0.01;
        composer.addPass( effect );

        effect = new THREE.GlitchPass();
        composer.addPass( effect );
        
        effect = new THREE.FilmPass( 0.3, 0.6, 256, false );
        composer.addPass( effect );

        effect.renderToScreen = true;

        controls.update();
        render(); 
      }
     
        renderContent();
        window.onresize = function(){ 
          var oldRendering = document.getElementById("mesh").childNodes;
          oldRendering[0].outerHTML = "";
          renderContent(); 
        }
           
        $(document).ready(function() {
          
          //open popup
          $( ".e" ).on( "click", function() { 
            $("#popup").css('display', 'flex');
            $( "#popup" ).animate({height:"80%"},500);
            $("#vid").animate({opacity:"1"},700);
            //$("#bggrad").animate({opacity:"0"},700);
            $("#popup").queue(function (next) { 
              $(".panel").css('display', 'none');
              next();
            });
          });
          
          //close
          $( "#popup" ).on( "click", function() { 
            $(".panel").css('display', 'flex'); 
            $( "#popup" ).animate({height:"0%"},500);
            $("#vid").animate({opacity:"0"},300);
            //$("#bggrad").animate({opacity:"0.4"},600);
            $("#popup").queue(function (next) { 
              $("#popup").css('display', 'none');   
              next();
            });
            
            $("#popup").queue(function (next) { 
              var oldRendering = document.getElementById("mesh").childNodes;
              oldRendering[0].outerHTML = "";
              renderContent();  
              next();
            });
            document.getElementById("vid").pause();
            
          });
        

        });  
        
    </script>
    
  </body>
   
</html>